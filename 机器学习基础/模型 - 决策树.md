# 决策树

tags: 机器学习

---

[TOC]

## 简介

决策树是一个分而治之的递归过程。 

- 开始，构建根节点，将所有训练数据都放在根节点。
- **选择一个最优特征**，按照这一特征将训练数据集分割成子集，使得各个子集有一个在当前条件下最好的分类
- 如果子集未分类完毕，则在子集中选择一个最优特征，继续进行划分，直到所有训练数据子集都被正确分类或没有合适的特征为止。

## 决策树三要素

- **特征选择：** 从训练数据中众多的特征中选择一个特征作为当前节点的分裂标准，如何选择特征有着很多不同量化评估标准标准，从而衍生出不同的决策树算法。 
- **决策树生成：**根据选择的特征评估标准，从上至下递归地生成子节点，直到数据集不可分则停止决策树停止生长。
- **决策树的修剪：**决策树容易过拟合，一般来需要剪枝，缩小树结构规模、缓解过拟合。剪枝技术有预剪枝和后剪枝两种。

## 决策树优缺点

- 优点：

  > - 相比于其他算法需要大量数据集而已，决策树算法要求的数据集不大。
  >
  > - 决策树算法的时间复杂度较小，为用于训练决策树的数据点的对数。
  >
  > - 相比于其他算法智能分析一种类型变量，决策树算法可处理数字和数据的类别。
  >
  > - 能够处理多输出的问题。 
  >
  > - **对缺失值不敏感。**
  >
  > - 可以处理不相关特征数据。
  >
  > - 效率高，决策树只需要一次构建，反复使用，每一次预测的最大计算次数不超过决策树的深度。

- 缺点

  > - 对连续性的字段比较难预测。
  >
  > - 容易出现过拟合。
  >
  > - 当类别太多时，错误可能就会增加的比较快。
  >
  > - 信息缺失时处理起来比较困难，忽略了数据集中属性之间的相关性。
  >
  > - 在处理特征关联性比较强的数据时表现得不是太好。
  >
  > - 对于各类别样本数量不一致的数据，在决策树当中,信息增益的结果偏向于那些具有更多数值的特征。

## 1. 特征的选择

有三种方法进行特征选择：ID3: 信息增益，C4.5: 信息增益比，CART: 基尼系数

### 1. ID3: 信息增益

**思想：** 计算所有特征划分数据集D，得到多个特征划分数据集D的信息增益，从这些信息增益中选择最大的，因而当前结点的划分特征便是使信息增益最大的划分所使用的特征。

```
1.对当前例子集合，计算各属性的信息增益；
2.选择信息增益最大的属性Ak；
3.把在Ak处取值相同的例子归于同一子集，Ak取几个值就得几个子集；
4.对既含正例又含反例的子集，递归调用建树算法；
5.若子集仅含正例或反例，对应分枝标上P或N，返回调用处。
```

**信息增益：** 度量以**某特征划分数据集前后的信息熵的差值**。 信息熵能够表示样本集合的不确定性，因此我们能够通过前后集合信息熵的差值来衡量使用当前特征对于样本集合D划分效果的好坏。

假设划分前样本集合D的熵为 $H(D)$。使用某个特征A划分数据集D，计算划分后的数据子集的熵为 $H(D|A)$ 。
$$
信息熵：H(D) = - \sum_{k=1}^k \frac{|C_k|}{|D|} log_2 \frac{|C_k|}{|D|} \\
条件熵： H(D|A) = \sum_{i=1}^n \frac{|D_i|}{|D|} H(D_i) \\
信息增益： g(D,A)=H(D)-H(D|A)
$$
**注意：** 在决策树构建中，我们总是希望集合往最快到达**纯度更高** 的子集合发展，因此我们总是选择是的**信息增益最大的特征**来划分当前集合。

- 缺点：信息增益对**分支较多的属性**有所偏好，因此有人提出采用**信息增益比**来划分特征。

### 2. C4.5: 信息增益比

信息增益比本质：在信息增益的基础之上乘上一个惩罚参数。特征个数较多时，惩罚参数较小；特征个数较少时，惩罚参数较大。
$$
信息增益比 = 惩罚参数 \times 信息增益 \\
信息增益比：g_R(D,A) = \frac{g(D,A)}{H(D)}
$$
**信息增益比对可取值数目较少的属性有所偏好。C4.5 先从候选划分属性中找出信息增益高于平均水平的属性，再从中选择信息增益比最高的。**

相对于 ID3 算法的改进：

- 用**信息增益比**来选择属性，克服了用信息增益选择属性**偏向选择多值属性的不足**

### 3. CART: 基尼系数



## 2. 剪枝处理

### 0. 剪枝的作用

剪枝处理是决策树学习算法用来**解决过拟合**的一种办法。

在决策树算法中，为了尽可能正确分类训练样本， 节点划分过程不断重复， 有时候会造成决策树分支过多，以至于将训练样本集自身特点当作泛化特点， 而导致过拟合。 因此可以采用剪枝处理来去掉一些分支来降低过拟合的风险。 

### 1. 预剪枝

在决策树生成过程中，在每个节点划分前先估计其划分后的泛化性能， 如果不能提升，则停止划分，将当前节点标记为叶结点。 

### 2. 后剪枝

生成决策树以后，再自下而上对非叶结点进行考察， 若将此节点标记为叶结点可以带来泛化性能提升，则修改之。

---

## QA

### 1. ID3, C4.5, CART 这三种决策树的区别

- ID3 决策树优先选择**信息增益大**的属性来对样本进行划分， 但是这样的划分方法有一个很大的缺点： 当一个**属性可取值数目较多时**， 可能在这个属性对应值下的样本**只有一个或者很少个**， 此时它的信息增益将很高， ID3会认为这个属性很适合划分。
- C4.5树：不采用信息增益作为划分依据，而是采用**信息增益率**作为划分依据。但是仍不能完全解决以上问题,而是有所改善。
- CART树：它使用**gini系数**作为节点的分裂依据。